<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Luxta Academy - Link</title>

<style>
  @font-face { font-family: 'PixelFont'; src: url('pixil.otf') format('opentype'); }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  html, body {
    height: 100%; width: 100%;
    font-family: 'PixelFont', monospace;
    background: #424242; color: #fff;
    display: flex; justify-content: center; align-items: center; flex-direction: column;
  }
  #frame {
    background: #2c2c2c; padding: 30px 40px; border-radius: 15px;
    text-align: center; width: 90%; max-width: 400px;
    box-shadow: 0 0 20px rgba(200,120,255,0.5);
  }
  #l_name { font-size: 24px; margin-bottom: 20px; }
  progress { width: 100%; height: 20px; margin-bottom: 20px; appearance: none; border-radius: 10px; }
  progress::-webkit-progress-bar { background: #555; border-radius: 10px; }
  progress::-webkit-progress-value { background-color: #c879ff; border-radius: 10px; }
  .start { padding: 10px 20px; background: linear-gradient(45deg,#c879ff,#8f49ff); border: none; border-radius: 10px; color: #fff; font-size: 18px; cursor: pointer; }
  .cre { color: #aaa; margin-top: 20px; font-size: 12px; }
</style>
</head>

<body>
<div id="frame">
  <p id="l_name">Link</p>
  <p id="count">0/2</p>
  <progress value="0" max="2"></progress>
  <button class="start">Bắt đầu</button>
</div>

<p class="cre">Created and managed by Luxta Academy</p>

<script>
const url = new URL(location.href);
const uid = url.searchParams.get("uid");
const linkId = url.searchParams.get("link") || "1";

// --- kiểm tra UID hợp lệ ---
if (!uid || uid.trim() === "") {
  alert("Không tìm thấy UID. Mở từ trong app!");
  throw new Error("Missing UID");
}

// --- lưu UID + LinkID + startTime ---
localStorage.setItem("luxta_userid", uid);
localStorage.setItem("luxta_linkid", linkId);
localStorage.setItem("luxta_startTime", Date.now());

// --- debug ---
console.log("UID:", uid, "LinkID:", linkId, "StartTime:", localStorage.getItem("luxta_startTime"));

// --- hiển thị link ---
document.getElementById("l_name").textContent = "Link " + linkId;

// --- UI ---
const progressBar = document.querySelector("progress");
const countText = document.getElementById("count");
const startBtn = document.querySelector(".start");
const today = new Date().toDateString();
let saved = JSON.parse(localStorage.getItem("luxta_linkdata") || "{}");
if (!saved[linkId] || saved[linkId].date !== today) saved[linkId] = { date: today, count: 0 };
updateUI();

startBtn.addEventListener("click", () => {
  if (saved[linkId].count >= 2) {
    alert("Hôm nay bạn đã vượt đủ 2 lần của link này.");
    return;
  }

  saved[linkId].count++;
  localStorage.setItem("luxta_linkdata", JSON.stringify(saved));
  updateUI();

  let link4mMap = {
    "1": "https://link4m.com/1Vsz3xRi",
    "2": "https://link4m.com/ZQlmO1n3",
    "3": "https://link4m.com/TPCkWBGi",
    "4": "https://link4m.com/NVkn5Dau",
    "5": "https://link4m.com/YKHQL",
    "6": "https://link4m.com/q7TqCk6",
    "7": "https://link4m.com/DxmpJ",
    "8": "https://link4m.com/aL0DVES",
    "9": "https://link4m.com/GLByKUo",
    "10": "https://link4m.com/parIcS",
    "11": "https://link4m.com/iuvJntY",
    "12": "https://link4m.com/LhvuriKb",
    "13": "https://link4m.com/qzSsMWck",
    "14": "https://link4m.com/CE3WRh",
    "15": "https://link4m.com/1FovR",
    "16": "https://link4m.com/r8Q3QYW",
    "17": "https://link4m.com/Jrj7X",
    "18": "https://link4m.com/HQZYVO",
    "19": "https://link4m.com/cPt88",
    "20": "https://link4m.com/Q7BrN"
  };

  let targetLink = link4mMap[linkId] || "https://link4m.co/default";
  setTimeout(() => { window.location.href = targetLink; }, 800);
});

function updateUI() {
  progressBar.value = saved[linkId].count;
  countText.textContent = `${saved[linkId].count}/2`;
}
</script>
</body>
</html>